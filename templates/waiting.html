{% block content %}
    <style>
        #waiting_block {
            background: #ffffff55;
            margin-top: 2vh;
            margin-bottom: 2vh;
            height: 96vh;
            border-radius: 2em;
        }

        #container {
            height: 96vh !important;
            width: 50vw !important;
        }

        #container canvas {
            border-radius: 2em;
        }

        #waiting_text {
            font-size: 2em;
            position: absolute;
            color: #2250ef;
            font-weight: bold;
            left: 50%;
            bottom: 10%;
            transform: translateX(-50%);
        }

        .typed-cursor {
            display: none;
        }

    </style>
    <div id="waiting_block">
        <div id="container"></div>
        <div id="waiting_text"></div>
    </div>
    <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>

    <script>
        let options = {
            strings: [
                "Hmmmmm...",
                "Waiting another player...",
                "It may take time...",
                "You can invite a friend...",
                "If you have one, of course...."
            ],
            typeSpeed: 50,
            backSpeed: 25,
            loop: true
        };
        let typed = new Typed('#waiting_text', options);
    </script>
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three/+esm",
                "controls": "https://cdn.jsdelivr.net/npm/three/examples/jsm/controls/OrbitControls.js",
                "gltf": "https://cdn.jsdelivr.net/npm/three/examples/jsm/loaders/GLTFLoader.js"
			}
	}
    </script>
    <script type="module">
        import * as THREE from 'three';
        import {GLTFLoader} from 'gltf';
        import {OrbitControls} from 'controls';


        let container, clock, mixer, actions, activeAction, previousAction;
        let camera, scene, renderer, model, face, controls;

        const api = {state: 'Walking'};

        init();
        animate();

        function init() {

            container = document.getElementById('container');

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.25, 100);
            camera.position.set(-5, 3, 10);
            camera.lookAt(0, 2, 0);


            scene = new THREE.Scene();

            clock = new THREE.Clock();

            // lights

            const hemiLight = new THREE.HemisphereLight(0xffffff, 0x8d8d8d, 3);
            hemiLight.position.set(0, 20, 0);
            scene.add(hemiLight);

            const dirLight = new THREE.DirectionalLight(0xffffff, 3);
            dirLight.position.set(0, 20, 10);
            scene.add(dirLight);


            const loader = new GLTFLoader();
            loader.load('https://threejs.org/examples/models/gltf/RobotExpressive/RobotExpressive.glb', function (gltf) {
                model = gltf.scene;
                scene.add(model);
                createGUI(model, gltf.animations);
            }, undefined, function (e) {
                console.error(e);
            });

            renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            renderer.setClearColor(0x000000, 0);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.target = new THREE.Vector3(0, 2, 0);

            window.addEventListener('resize', onWindowResize);
            setInterval(onWindowResize, 100);
        }

        function createGUI(model, animations) {
            mixer = new THREE.AnimationMixer(model);

            actions = {};

            for (let i = 0; i < animations.length; i++) {
                const clip = animations[i];
                actions[clip.name] = mixer.clipAction(clip);
            }
            face = model.getObjectByName('Head_4');
            activeAction = actions['Walking'];
            activeAction.play();
        }

        function onWindowResize() {
            let width = container.clientWidth;
            let height = container.clientHeight;
            renderer.setSize(width, height);

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        function animate() {

            const dt = clock.getDelta();

            if (mixer) mixer.update(dt);
            controls.update();
            requestAnimationFrame(animate);

            renderer.render(scene, camera);

        }

    </script>
{% endblock %}